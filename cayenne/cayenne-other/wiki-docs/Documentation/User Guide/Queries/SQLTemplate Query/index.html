<html>
  <head>
    <title>Cayenne Documentation - SQLTemplate Query</title>
    <style type="text/css">@import "../../../../style.css";</style>
  </head>
<body>
  <div class="header">
    <div style="float: left;"><a href="http://objectstyle.org/cayenne/"><img src="../../../../images/logo.gif" align="absmiddle" border="0"></a></div>
    <span class="logoSpaceLink"><a href="../../../../index.html">Cayenne User Documentation</a></span><br />
    <span class="pagetitle">SQLTemplate Query</span>
  </div>
<div id="cayenne_toc">
<ul>
<li><a href="../../../../Documentation/User Guide/Introduction/index.html">Introduction</a></li>
<li><a href="../../../../Documentation/User Guide/Installation/index.html">Installation</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/index.html">Quick Start</a></li>
<li><a href="../../../../Documentation/User Guide/Design/index.html">Design</a></li>
<li><a href="../../../../Documentation/User Guide/DataContext/index.html">DataContext</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/index.html">Queries</a><ul>
<li><a href="../../../../Documentation/User Guide/Queries/SelectQuery/index.html">SelectQuery</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Qualifier Expressions/index.html">Qualifier Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Using Orderings/index.html">Using Orderings</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/SelectQuery Customization/index.html">SelectQuery Customization</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Parameterized Queries/index.html">Parameterized Queries</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/SQLTemplate Query/index.html">SQLTemplate Query</a><ul>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Queries/Scripting SQLTemplate/index.html">Scripting SQLTemplate</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Queries Stored in DataMap/index.html">Queries Stored in DataMap</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Caching Query Results/index.html">Caching Query Results</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/Customizing Queries/index.html">Customizing Queries</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/NamedQuery/index.html">NamedQuery</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/ObjectIdQuery/index.html">ObjectIdQuery</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/QueryChain/index.html">QueryChain</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/RelationshipQuery/index.html">RelationshipQuery</a></li>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/DataObjects/index.html">DataObjects</a></li>
<li><a href="../../../../Documentation/User Guide/Stored Procedures/index.html">Stored Procedures</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/index.html">Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Performance Tuning/index.html">Performance Tuning</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/index.html">Deployment</a></li>
<li><a href="../../../../Documentation/User Guide/Ant Tasks/index.html">Ant Tasks</a></li>
<li><a href="../../../../Documentation/User Guide/Customizing/index.html">Customizing</a></li>
<li><a href="../../../../Documentation/User Guide/DataViews/index.html">DataViews</a></li>
</ul>
</div>
<div id="ConfluenceContent"><p>Not all features of SQL can (or should) be mapped in the object model in terms of DataObjects. For such cases Cayenne provides a powerful mechanism for running both selecting and non-selecting SQL using scriptable <span class="nobr"><a href="http://objectstyle.org/cayenne/api/cayenne/org/objectstyle/cayenne/query/SQLTemplate.html" title="Visit page outside Confluence" rel="nofollow">SQLTemplate<sup><img class="rendericon" src="../../../../images/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> query. This chapter describes how simple SQLTemplates can be created and executed with DataContext to select or update the database data. Subsequent chapters show how to build SQL dynamically, bind parameters and describe result sets using SQLTemplate scripting features.</p>

<h3><a name="SQLTemplateQuery-CreatingSQLTemplate"></a>Creating SQLTemplate</h3>

<p>SQLTemplates can be built using CayenneModeler. Here we demonstrate how to do the same thing via API. SQLTemplate consists of root and dynamic template string. Dynamic behavior of the template is discussed in subsequent chapters, for now it is sufficient to know that the template string is simply a valid SQL statement in the target database SQL dialect.</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">import</span> org.objectstyle.cayenne.query.SQLTemplate;
...
<span class="code-comment">// create selecting SQLTemplate
</span>SQLTemplate selectQuery = <span class="code-keyword">new</span> SQLTemplate(Artist.class, <span class="code-quote">"select * from ARTIST"</span>);
...
<span class="code-comment">// create updating SQLTemplate
</span>SQLTemplate updateQuery = <span class="code-keyword">new</span> SQLTemplate(Artist.class, <span class="code-quote">"delete from ARTIST"</span>);</pre>
</div></div>

<h3><a name="SQLTemplateQuery-SelectingObjectswithSQLTemplate"></a>Selecting Objects with SQLTemplate</h3>

<p>Selecting SQLTemplate is very similar to SelectQuery in many respects. It can be executed via <tt>DataContext.performQuery(..)</tt> and supports the same configuration parameters, such as fetch limit, pagination, etc. It can be configured to return DataObjects (default) or data rows.</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">import</span> org.objectstyle.cayenne.query.SQLTemplate;
...
<span class="code-comment">// fetch all artists, but no more than 1000 objects...
</span>SQLTemplate rawSelect = <span class="code-keyword">new</span> SQLTemplate(Artist.class, <span class="code-quote">"select * from ARTIST"</span>);
rawSelect.setFetchLimit(1000);

List artists = dataContext.performQuery(rawSelect);</pre>
</div></div>

<h3><a name="SQLTemplateQuery-ModifyingDatawithSQLTemplate"></a>Modifying Data with SQLTemplate</h3>

<p>Non-selecting SQLTemplate allows to execute arbitrary SQL that modifies the database, but does not return the results. <tt>DataContext.performNonSelectingQuery(..)</tt> is used for this task.</p>

<table cellpadding='5' width='85%' cellspacing='8px' class='noteMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="../../../../images/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When changing or deleting data via SQLTemplate you must realize that such changes are done directly to the database, bypassing the context, and therefore may potentially leave object graph in an inconsistent state.</td></tr></table>

<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">import</span> org.objectstyle.cayenne.query.SQLTemplate;
...
<span class="code-comment">// fetch all artists, but no more than 1000 objects...
</span>SQLTemplate rawDelete = <span class="code-keyword">new</span> SQLTemplate(Artist.class, <span class="code-quote">"delete from ARTIST"</span>);
<span class="code-object">int</span>[] deleteCounts = dataContext.performNonSelectingQuery(rawDelete);</pre>
</div></div>

<h3><a name="SQLTemplateQuery-CustomizingSQLDialects"></a>Customizing SQL Dialects</h3>

<p>Even though SQL is an industry standard, different DB vendors still have their own dialects and extensions. Two versions of the same query written for Oracle and PostgreSQL may look quiet different.</p>

<p>Each SQLTemplate query has a default template, usually set in constructor. Internally it also keeps a map of alternative templates. This map normally uses a fully-qualified class name of the target DbAdapter as a key. This way Cayenne can determine which one of the SQL strings to use during the execution. Alternative SQL strings are configured using <tt>SQLTemplate.setTemplate(...)</tt>:</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-comment">// build template with <span class="code-keyword">default</span> SQL
</span>SQLTemplate query = <span class="code-keyword">new</span> SQLTemplate(Artist.class, <span class="code-quote">"select * from ARTIST"</span>);

<span class="code-comment">// <span class="code-keyword">for</span> Postgres it would be nice to trim the CHAR ARTIST_NAME column
</span><span class="code-comment">// or otherwise it will be returned padded with spaces
</span><span class="code-object">String</span> pgTemplate = <span class="code-quote">"SELECT ARTIST_ID, RTRIM(ARTIST_NAME), DATE_OF_BIRTH FROM ARTIST"</span>;
query.setTemplate(PostgresAdapter.class.getName(), pgTemplate);</pre>
</div></div></div>
</div>
  <div class="clearer">.</div>
  <div style="height: 12px; background-image: url('../../../../images/border_bottom.gif'); background-repeat: repeat-x;"></div>

  <div class="smalltext copyright">
    Copyright &copy;2001-2006 ObjectStyle Group and content authors
  </div>

</body>
</html>
