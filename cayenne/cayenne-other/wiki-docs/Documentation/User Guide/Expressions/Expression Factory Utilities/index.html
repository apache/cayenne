<html>
  <head>
    <title>Cayenne Documentation - Expression Factory Utilities</title>
    <style type="text/css">@import "../../../../style.css";</style>
  </head>
<body>
  <div class="header">
    <div style="float: left;"><a href="http://objectstyle.org/cayenne/"><img src="../../../../images/logo.gif" align="absmiddle" border="0"></a></div>
    <span class="logoSpaceLink"><a href="../../../../index.html">Cayenne User Documentation</a></span><br />
    <span class="pagetitle">Expression Factory Utilities</span>
  </div>
<div id="cayenne_toc">
<ul>
<li><a href="../../../../Documentation/User Guide/Introduction/index.html">Introduction</a></li>
<li><a href="../../../../Documentation/User Guide/Installation/index.html">Installation</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/index.html">Quick Start</a></li>
<li><a href="../../../../Documentation/User Guide/Design/index.html">Design</a></li>
<li><a href="../../../../Documentation/User Guide/DataContext/index.html">DataContext</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/index.html">Queries</a></li>
<li><a href="../../../../Documentation/User Guide/DataObjects/index.html">DataObjects</a></li>
<li><a href="../../../../Documentation/User Guide/Stored Procedures/index.html">Stored Procedures</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/index.html">Expressions</a><ul>
<li><a href="../../../../Documentation/User Guide/Expressions/Path Expressions/index.html">Path Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/Building Expressions/index.html">Building Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/Expression Factory Utilities/index.html">Expression Factory Utilities</a><ul>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Expressions/NULL Handling/index.html">NULL Handling</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/In-Memory Evaluation/index.html">In-Memory Evaluation</a></li>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Performance Tuning/index.html">Performance Tuning</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/index.html">Deployment</a></li>
<li><a href="../../../../Documentation/User Guide/Ant Tasks/index.html">Ant Tasks</a></li>
<li><a href="../../../../Documentation/User Guide/Customizing/index.html">Customizing</a></li>
<li><a href="../../../../Documentation/User Guide/DataViews/index.html">DataViews</a></li>
</ul>
</div>
<div id="ConfluenceContent"><p>Sometimes there is a need to build an expression by combining other existing expressions. Also quiet often it is desirable to use strongly typed API instead of interpreted string expressions. The following sections describe <span class="nobr"><a href="http://objectstyle.org/cayenne/api/cayenne/org/objectstyle/cayenne/exp/ExpressionFactory.html" title="Visit page outside Confluence" rel="nofollow">ExpressionFactory<sup><img class="rendericon" src="../../../../images/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> and <span class="nobr"><a href="http://objectstyle.org/cayenne/api/cayenne/org/objectstyle/cayenne/exp/Expression.html" title="Visit page outside Confluence" rel="nofollow">Expression<sup><img class="rendericon" src="../../../../images/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> methods that allow to construct expressions step by step via API calls.</p>

<h3><a name="ExpressionFactoryUtilities-Path%2FValueExpressions"></a>Path/Value Expressions</h3>

<p>The most simple expressions are the ones that match an object property path with a value or a list of values. ExpressionFactory provides a set of methods to build such "path/value" expressions:</p>
<ul>
	<li>public static Expression <b>matchExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>noMatchExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>matchDbExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>lessExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>lessOrEqualExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>greaterExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>greaterOrEqualExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>inExp</b>(String pathSpec, Object[] values)</li>
	<li>public static Expression <b>inExp</b>(String pathSpec, java.util.List values)</li>
	<li>public static Expression <b>betweenExp</b>(String pathSpec, Object value1, Object value2)</li>
	<li>public static Expression <b>likeExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>likeIgnoreCaseExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>notInExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>notBetweenExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>notLikeExp</b>(String pathSpec, Object value)</li>
	<li>public static Expression <b>notLikeIgnoreCaseExp</b>(String pathSpec, Object value)</li>
</ul>


<p>As was mentioned <a href="../../../../Documentation/User Guide/Expressions/Path Expressions/index.html" title="Path Expressions">earlier</a>, the type of a second Object argument depends on the type of property path points to. It is important to mention that paths that end with a relationship name (both to-one and to-many) can be matched against DataObjects, thus removing the need to know PK or FK values when building expressions. This behavior is not specific to ExpressionFactory, it works the same way with Expression.fromString(..) as well.</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">import</span> org.objectstyle.cayenne.exp.Expression;
<span class="code-keyword">import</span> org.objectstyle.cayenne.exp.ExpressionFactory;
<span class="code-keyword">import</span> org.objectstyle.cayenne.query.SelectQuery;
...

<span class="code-comment">// find artist paintings (<span class="code-keyword">if</span> we don't want to use relationship <span class="code-keyword">for</span> whatever reason)
</span>
Artist a = ...;
Expression qual = ExpressionFactory.matchExp(<span class="code-quote">"toArtist"</span>, a);
SelectQuery select = <span class="code-keyword">new</span> SelectQuery(Painting.class, qual);</pre>
</div></div>

<h3><a name="ExpressionFactoryUtilities-ChainingExpressions"></a>Chaining Expressions</h3>

<p>Expression class itself provides a set of convenience methods to chain expressions as they are built from smaller parts. Note that each of these methods does not modify the original expression, rather it builds and returns a new instance of the expression.</p>
<ul>
	<li>public Expression <b>joinExp</b>(int type, Expression exp)<br/>
 Creates and returns a new expression that joins this object with another expression, using specified join type. This is a shorter equivalent of ExpressionFactory.binaryExpression(type, this, exp).</li>
	<li>public Expression <b>andExp</b>(Expression exp)<br/>
 A shorter equivalent for joinExp(Expression.AND, exp).</li>
	<li>public Expression <b>orExp</b>(Expression exp)<br/>
 A shorter equivalent for joinExp(Expression.OR, exp).</li>
</ul>


<p>Example of using chaining:</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">import</span> org.objectstyle.cayenne.exp.Expression;
<span class="code-keyword">import</span> org.objectstyle.cayenne.exp.ExpressionFactory;
<span class="code-keyword">import</span> org.objectstyle.cayenne.query.SelectQuery;
...

<span class="code-comment">// find artists whose name starts with <span class="code-quote">"D"</span>
</span><span class="code-comment">// with invalid or <span class="code-keyword">null</span> date of birth
</span>
Expression qual = ExpressionFactory.greaterOrEqualExp(<span class="code-quote">"dateOfBirth"</span>, <span class="code-keyword">new</span> Date());

<span class="code-comment">// 1. chain expressions, note the assignment back to <span class="code-quote">"qual"</span>,
</span><span class="code-comment">// since a <span class="code-keyword">new</span> instance is created
</span>qual = qual.orExp(ExpressionFactory.matchExp(<span class="code-quote">"dateOfBirth"</span>, <span class="code-keyword">null</span>));

<span class="code-comment">// 2. <span class="code-quote">"AND"</span> applies to a combined earlier criteria
</span>qual =
   qual.andExp(ExpressionFactory.likeIgnoreCaseExp(<span class="code-quote">"artistName"</span>, <span class="code-quote">"D%"</span>));

SelectQuery select = <span class="code-keyword">new</span> SelectQuery(Artist.class, qual);</pre>
</div></div>

<h3><a name="ExpressionFactoryUtilities-CreatingComplexExpressions"></a>Creating Complex Expressions</h3>

<p>There is a way to create complex expressions either from the Lists of expressions or from the Maps containing values using "path" Strings as keys. This approach significantly simplifies connecting Cayenne queries to the UI, and reduces the number of steps needed to create expressions in other cases. ExpressionFactory provides the following methods:</p>
<ul>
	<li>public static Expression <b>joinExp</b>(int type, java.util.List expressions)<br/>
 Joins all expressions into a single expression. type is used as an expression type for expressions joining each one of the items on the list. type is normally AND or OR.</li>
	<li>public static Expression <b>matchAllExp</b>(java.util.Map map, int type)<br/>
 Creates an expression that matches all path/value pairs in map. Path is OBJ_PATH.</li>
	<li>public static Expression <b>matchAllDbExp</b>(java.util.Map map, int type)<br/>
 Same as above, but path is interpreted to be DB_PATH.</li>
	<li>public static Expression <b>matchAnyExp</b>(java.util.Map map, int type)<br/>
 Creates an expression that matches any of the path/value pairs in map. Path is OBJ_PATH.</li>
	<li>public static Expression <b>matchAnyDbExp</b>(java.util.Map map, int type)<br/>
 Same as above, but path is interpreted to be DB_PATH.</li>
</ul>
</div>
</div>
  <div class="clearer">.</div>
  <div style="height: 12px; background-image: url('../../../../images/border_bottom.gif'); background-repeat: repeat-x;"></div>

  <div class="smalltext copyright">
    Copyright &copy;2001-2006 ObjectStyle Group and content authors
  </div>

</body>
</html>
