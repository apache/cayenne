<!--
   Licensed to the Apache Software Foundation (ASF) under one
   or more contributor license agreements.  See the NOTICE file
   distributed with this work for additional information
   regarding copyright ownership.  The ASF licenses this file
   to you under the Apache License, Version 2.0 (the
   "License"); you may not use this file except in compliance
   with the License.  You may obtain a copy of the License at
 
     http://www.apache.org/licenses/LICENSE-2.0
 
   Unless required by applicable law or agreed to in writing,
   software distributed under the License is distributed on an
   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
   KIND, either express or implied.  See the License for the
   specific language governing permissions and limitations
   under the License.
-->
<html>
  <head>
    <title>Apache Cayenne Documentation - DBCPDataSourceFactory</title>
    <style type="text/css">@import "../../../../style.css";</style>
  </head>
<body>
  <div class="header">
    <div style="float: left;"><a href="http://incubator.apache.org/cayenne/"><img src="../../../../images/logo.gif" align="absmiddle" border="0"></a></div>
    <span class="logoSpaceLink"><a href="../../../../index.html">Cayenne User Documentation</a></span><br />
    <span class="pagetitle">DBCPDataSourceFactory</span>
  </div>
<div id="cayenne_toc">
<ul>
<li><a href="../../../../Documentation/User Guide/Introduction/index.html">Introduction</a></li>
<li><a href="../../../../Documentation/User Guide/Installation/index.html">Installation</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/index.html">Quick Start</a></li>
<li><a href="../../../../Documentation/User Guide/Design/index.html">Design</a></li>
<li><a href="../../../../Documentation/User Guide/DataContext/index.html">DataContext</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/index.html">Queries</a></li>
<li><a href="../../../../Documentation/User Guide/DataObjects/index.html">DataObjects</a></li>
<li><a href="../../../../Documentation/User Guide/Stored Procedures/index.html">Stored Procedures</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/index.html">Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Performance Tuning/index.html">Performance Tuning</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/index.html">Deployment</a><ul>
<li><a href="../../../../Documentation/User Guide/Deployment/Standalone Applications/index.html">Standalone Applications</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/Web Applications/index.html">Web Applications</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/Customizing Configuration/index.html">Customizing Configuration</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/DBCPDataSourceFactory/index.html">DBCPDataSourceFactory</a><ul>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Deployment/Using JNDI/index.html">Using JNDI</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/Deployment with Ant/index.html">Deployment with Ant</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/Configuring Logging/index.html">Configuring Logging</a></li>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Ant Tasks/index.html">Ant Tasks</a></li>
<li><a href="../../../../Documentation/User Guide/Customizing/index.html">Customizing</a></li>
<li><a href="../../../../Documentation/User Guide/DataViews/index.html">DataViews</a></li>
</ul>
</div>
<div id="ConfluenceContent">
<p>As an alternative to a simple and easy-to-use DataSource bundled with Cayenne, it is possible to configure a more feature-rich DataSource based on Apache Jakarta <span class="nobr"><a href="http://jakarta.apache.org/commons/dbcp" title="Visit page outside Confluence" rel="nofollow">commons-dbcp<sup><img class="rendericon" src="../../../../images/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>. To enable commons-dbcp pool, select <tt>DBCPDataSourceFactory</tt> in the Modeler for a DataNode:</p>

<p><img src="dbcp-step1.jpg" align="absmiddle" border="0" /></p>

<p>Configuration is done in a properties file that has to be edited in a text editor outside CayenneModeler. The name of this file is specified in the Modeler (with path relative to cayenne.xml location):</p>

<p><img src="dbcp-step2.jpg" align="absmiddle" border="0" /></p>

<p>Here is an example of such properties file contents:</p>

<div class="code"><div class="codeHeader"><b>sample-dbcp.properties</b></div><div class="codeContent">
<pre class="code-java">cayenne.dbcp.driverClassName=com.mysql.jdbc.Driver
cayenne.dbcp.url=jdbc:mysql:<span class="code-comment">//localhost/cayenne
</span>cayenne.dbcp.username=john
cayenne.dbcp.password=secret
cayenne.dbcp.maxActive=20
cayenne.dbcp.minIdle=5
cayenne.dbcp.maxIdle=8
cayenne.dbcp.maxWait=10000</pre>
</div></div>

<h2><a name="DBCPDataSourceFactory-SupportedProperties"></a>Supported Properties</h2>

<p>Below is a full list of supported properties, that fall into three categories - DataSource properties, connection pool properties and prepared statement pool properties. Only DataSource properties are required.</p>

<h3><a name="DBCPDataSourceFactory-DataSourceProperties"></a>DataSource Properties</h3>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Property</th>
<th class='confluenceTh'>Description</th>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.driverClassName</td>
<td class='confluenceTd'>JDBC driver class</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.url</td>
<td class='confluenceTd'>Database JDBC URL</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.username</td>
<td class='confluenceTd'>Database login user name</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.password</td>
<td class='confluenceTd'>Database login password</td>
</tr>
</tbody></table>

<h3><a name="DBCPDataSourceFactory-ConnectionPoolProperties"></a>Connection Pool Properties</h3>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Property</th>
<th class='confluenceTh'>Description</th>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.maxActive</td>
<td class='confluenceTd'>Maximum number of active connections in the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.minIdle</td>
<td class='confluenceTd'>Minimum number of idle connections to keep in the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.maxIdle</td>
<td class='confluenceTd'>Maximum number of idle connections to keep in the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.maxWait</td>
<td class='confluenceTd'>A maximum time in milliseconds a caller should wait for a connection to be returned from the pool. -1 for indefinite.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.validationQuery</td>
<td class='confluenceTd'>A SQL query used to validate a connection, before returning it to the user. Must return at least one row. E.g. <tt>"select 1 from dual"</tt></td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.testOnBorrow</td>
<td class='confluenceTd'>A boolean specifying whether connection should be validated before being returned <b>from</b> the pool to the caller.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.testOnReturn</td>
<td class='confluenceTd'>A boolean specifying whether connection should be validated before being returned back <b>to</b> the pool.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.testWhileIdle</td>
<td class='confluenceTd'>A boolean specifying whether connection should be validated while it is idle.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.timeBetweenEvictionRunsMillis</td>
<td class='confluenceTd'>A number of milliseconds an eviction thread should sleep between the runs.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.numTestsPerEvictionRun</td>
<td class='confluenceTd'>A number of objects that an idle objects evictor should inspect on each run</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.minEvictableIdleTimeMillis</td>
<td class='confluenceTd'>Minimum time an object should sit in the pool, before it can be considered for eviction.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.whenExhaustedAction</td>
<td class='confluenceTd'>Specifies a pool behavior when the pool is exhausted and more connections are requested. Possible values are strings that follow the constant names defined in <tt>org.apache.commons.pool.impl.GenericObjectPool}: {{WHEN_EXHAUSTED_BLOCK</tt>, <tt>WHEN_EXHAUSTED_GROW</tt>, <tt>WHEN_EXHAUSTED_FAIL</tt>. If ommitted, <tt>WHEN_EXHAUSTED_BLOCK</tt> is assumed.</td>
</tr>
<tr>
<td class='confluenceTd'>caynne.dbcp.defaultAutoCommit</td>
<td class='confluenceTd'>Auto-commit policy for connections returned from the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.defaultReadOnly</td>
<td class='confluenceTd'>Read-only policy for connections returned from the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.defaultTransactionIsolation</td>
<td class='confluenceTd'>Specifies transaction isolation for connections returned from the pool. Possible values are strings that follow the constant names defined in the <tt>java.sql.Connection</tt> interface: <tt>TRANSACTION_NONE</tt>, <tt>TRANSACTION_READ_COMMITTED</tt>, <tt>TRANSACTION_READ_UNCOMMITTED</tt>, <tt>TRANSACTION_REPEATABLE_READ</tt>, <tt>TRANSACTION_SERIALIZABLE</tt></td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.accessToUnderlyingConnectionAllowed</td>
<td class='confluenceTd'>If set to true the application will be able to get access to the actual connection object which is normally wrapped by a poolable connections</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.defaultCatalog</td>
<td class='confluenceTd'>Default catalog of connections created by the pool</td>
</tr>
</tbody></table>

<h3><a name="DBCPDataSourceFactory-PreparedStatementPoolProperties"></a>PreparedStatement Pool Properties</h3>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Property</th>
<th class='confluenceTh'>Description</th>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.poolPreparedStatements</td>
<td class='confluenceTd'>Specifies whether PreparedStatements should be pooled</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.maxActive</td>
<td class='confluenceTd'>Specifies the maximum number of PreparedStatements that can be borrowed from the pool at one time</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.maxIdle</td>
<td class='confluenceTd'>Maximum number of idle PreparedStatements in the pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.maxTotal</td>
<td class='confluenceTd'>Maximum number of PreparedStatements that can exist in the pool at one time</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.maxWait</td>
<td class='confluenceTd'>A maximum time in milliseconds a caller should wait for a PreparedStatement to be returned from the pool. -1 for indefinite.</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.minEvictableIdleTimeMillis</td>
<td class='confluenceTd'>Number of milliseconds a PreparedStatement can sit idle in the pool before it is elegible for eviction</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.numTestsPerEvictionRun</td>
<td class='confluenceTd'>Number of idle PreparedStatements that should be examined per eviction run</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.testOnBorrow</td>
<td class='confluenceTd'>Specifies whether a PreparedStatement should be validated before being borrowed from this pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.testOnReturn</td>
<td class='confluenceTd'>Specifies whether a PreparedStatement should be validated before being returne to this pool</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.testWhileIdle</td>
<td class='confluenceTd'>Specifies whether PreparedStatements should be validated in the idle eviction thread</td>
</tr>
<tr>
<td class='confluenceTd'>cayenne.dbcp.ps.timeBetweenEvictionRunsMillis</td>
<td class='confluenceTd'>Specifies the time between the runs of the eviction thread</td>
</tr>
<tr>
<td class='confluenceTd'> cayenne.dbcp.ps.whenExhaustedAction</td>
<td class='confluenceTd'>Specifies a pool behavior when the pool is exhausted and more PreparedStatements are requested. Possible values are strings that follow the constant names defined in <tt>org.apache.commons.pool.impl.GenericObjectPool}: {{WHEN_EXHAUSTED_BLOCK</tt>, <tt>WHEN_EXHAUSTED_GROW</tt>, <tt>WHEN_EXHAUSTED_FAIL</tt>. If ommitted, <tt>WHEN_EXHAUSTED_BLOCK</tt> is assumed.</td>
</tr>
</tbody></table></div>
</div>
  <div class="clearer">.</div>
  <div style="height: 12px; background-image: url('../../../../images/border_bottom.gif'); background-repeat: repeat-x;"></div>

  <div class="smalltext copyright">
    Copyright &copy;2001-2006 Apache Software Foundation
  </div>

</body>
</html>
