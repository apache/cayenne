<?xml version="1.0"?>

<!-- ================================================= -->
<!--  Parser Build Tasks                               -->
<!-- ================================================= -->
<project>
	
	<target name="javacc" depends="javacc-nodir,javacc-nogrammar">
		<java fork="true" classname="javacc" failonerror="true">
			<classpath refid="classpath-javacc"/>
			<arg value="-OUTPUT_DIRECTORY:${parser.dir}"/>
			<arg value="${parser.dir}/${parser.base}.jj"/>
		</java>
	</target>
	
	<target name="jjtree" depends="javacc-nodir,javacc-nogrammar,jjtree-uptodate"
		unless="jj.uptodate">
		<java fork="true" classname="jjtree" failonerror="true">
			<classpath refid="classpath-javacc"/>
			<arg value="-OUTPUT_DIRECTORY:${parser.dir}"/>
			<arg value="${parser.dir}/${parser.base}.jjt"/>
		</java>
		
		<java fork="true" classname="javacc" failonerror="true">
			<classpath refid="classpath-javacc"/>
			<arg value="-OUTPUT_DIRECTORY:${parser.dir}"/>
			<arg value="${parser.dir}/${parser.base}.jj"/>
		</java>
	</target>
	
	<target name="jjdoc"
		depends="jjtree,javacc-nodir,javacc-nogrammar,jjdoc-uptodate"
		unless="jjdoc.uptodate">
		<!-- this property may be reset by the caller. -->
		<property name="parser.doc.dir" value="${parser.dir}"/>
		<java fork="true" classname="jjdoc" failonerror="true">
			<classpath refid="classpath-javacc"/>
			<arg value="-OUTPUT_FILE:${parser.doc.dir}/${parser.base}.html"/>
			<arg value="${parser.dir}/${parser.base}.jj"/>
		</java>
	</target>
	
	<target name="jjtree-uptodate" depends="javacc-nodir,javacc-nogrammar">
		<uptodate property="jj.uptodate"
			targetfile="${parser.dir}/${parser.base}.jj"
			srcfile="${parser.dir}/${parser.base}.jjt"/>
	</target>
	
	<target name="jjdoc-uptodate" depends="javacc-nodir,javacc-nogrammar">
		<uptodate property="jjdoc.uptodate"
			targetfile="${parser.doc.dir}/${parser.base}.html"
			srcfile="${parser.dir}/${parser.base}.jj"/>
	</target>
	
	<target name="javacc-nodir" unless="parser.dir">
		<fail>"parser.dir" is undefined.</fail>
	</target>
	
	<target name="javacc-nogrammar" unless="parser.base">
		<fail>"parser.base" is undefined.</fail>
	</target>
	
</project>
